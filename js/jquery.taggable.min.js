!function(a){a.fn.taggable=function(b){function o(b){var e=a(c.searchByValue?h:i).not(j).get(),f="";return""===b?(a.each(e,function(a,b){f+=p(d.autoCompleteElement,b)}),f):(a.each(e,function(a,c){c.match(new RegExp(b,"i"))&&(f+=p(d.autoCompleteElement,c))}),f)}function p(a,b,c){return c||(c="{content}"),a.replace(new RegExp(c,"ig"),b)}function q(){var b=k.find("li.tag span.tag-view").map(function(b,c){return a(this).text().trim().replace(/×/,"")});return b.length?b:[]}function r(){var b="";a.each(q(),function(c,e){var f=a.inArray(e,i);f!==-1&&(e=h[f]),b+=p(d.selectOptionElement,e)}),f.html(b)}var c=a.extend(!0,{},{autoCompleteSearch:!0,autoCompleteSmartDisplay:!0,searchByValue:!1,allowOtherWords:!1},b),d={tagsList:'<div class="tags-wrapper"><ul class="tags clear"><li class="tag"><input class="tag-editor" type="text" /></li></ul></div>',tag:'<li class="tag"><span class="tag-view"><span class="tag-close">&times;</span>{content}</span></li>',autoCompleteList:'<ul style="left:{left}; " class="auto-comp-list">{content}</ul>',autoCompleteElement:'<li class="auto-comp-elem">{content}</li>',selectOptionElement:'<option value="{content}" selected ></option>',tagTempEditorElement:'<li class="tag"><input class="tag-temp-editor" type="text" /></li>'},e=a(document),f=a(this).hide(),g=f.find("option"),h=g.map(function(b,c){return a(this).val().trim()}),i=g.map(function(b,c){return a(this).text().trim()}),j=null;f.after(d.tagsList);var k=a("ul.tags"),m=(k.find("li.tag"),k.find("li.tag > input.tag-editor")),n=m;return m.on("keydown",function(b){var e=a(this),f=e.val(),g=e.closest("li.tag");if(13==b.keyCode){if(a.inArray(f.trim(),j)===-1&&""!==f.trim()&&(a.inArray(f.trim(),c.searchByValue?h:i)!==-1||c.allowOtherWords)){var l=p(d.tag,f.trim());g.before(l),e.val(""),r()}b.preventDefault()}else if(8==b.keyCode&&""===f){var m=k.find("li.tag").not(g[0]).last();e.val(m.find("span.tag-view").text().trim().replace(/×/,"")),m.remove(),b.preventDefault()}j=q()}),m.on("keyup focusin",function(b){if($this=a(this),c.autoCompleteSearch){a("ul.auto-comp-list").remove();var e=p(d.autoCompleteList,o($this.val().trim()));e=p(e,$this.position().left+"px","{left}"),k.after(e)}n=$this.closest("li.tag")}),e.on("click","ul.tags li.tag span.tag-view span.tag-close",function(b){a(this).closest("li.tag").remove(),j=q(),k.click(),r()}),e.on("dblclick","ul.tags li.tag span.tag-view",function(b){a("ul.auto-comp-list").remove();var c=a(d.tagTempEditorElement),e=c.find("input.tag-temp-editor");e.val(a(this).text().trim().replace(/×/,"")),a(this).closest("li.tag").replaceWith(c),e.focus(),n=c,k.click()}),e.on("keydown","ul.tags li.tag input.tag-temp-editor",function(b){var e=a(this),f=e.val(),g=e.closest("li.tag");if(13==b.keyCode){if(a.inArray(f.trim(),j)===-1&&""!==f.trim()&&(a.inArray(f.trim(),c.searchByValue?h:i)!==-1||c.allowOtherWords)){var k=p(d.tag,f.trim());g.replaceWith(a(k)),r()}b.preventDefault()}else 8==b.keyCode&&""===f&&(g.remove(),a("ul.auto-comp-list").remove());j=q()}),e.on("keyup focusin","ul.tags li.tag input.tag-temp-editor",function(b){if($this=a(this),c.autoCompleteSearch){a("ul.auto-comp-list").remove();var e=p(d.autoCompleteList,o($this.val().trim()));e=p(e,$this.position().left+"px","{left}"),k.after(e)}n=$this.closest("li.tag")}),e.on("click","ul.auto-comp-list li.auto-comp-elem",function(b){$this=a(this);var c=p(d.tag,$this.text().trim());if(n.find("input.tag-temp-editor").length)n.replaceWith(a(c));else{var e=m.closest("li.tag");e.before(c),m.val("")}$this.closest("ul.auto-comp-list").remove(),k.click(),j=q(),r()}),c.autoCompleteSmartDisplay&&e.on("click",function(b){0===a(b.target).closest("div.tags-wrapper").length&&(a("ul.auto-comp-list").remove(),n=m)}),k.on("click",function(a){n.focus(),c.autoCompleteSearch&&n.keyup()}),c.autoCompleteSmartDisplay||k.click(),a(this)}}(jQuery);